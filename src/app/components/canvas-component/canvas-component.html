<div class="canvas-container" #canvasContainer (click)="onCanvasClick($event)">
  <div class="canvas-grid"></div>
  <svg class="canvas-svg" #canvasSvg>
    <!-- Grid pattern -->
    <defs>
      <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
        <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e2e8f0" stroke-width="0.5"/>
      </pattern>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" 
              refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6" />
      </marker>
    </defs>
    <rect width="100%" height="100%" fill="url(#grid)" opacity="1"/>
    
    <!-- Relationship lines -->
    @for (relationship of relationships; track $index) {
    <g>
      <ng-container *ngIf="getEntityById(relationship.fromEntityId) as fromEntity">
        <ng-container *ngIf="getEntityById(relationship.toEntityId) as toEntity">
          <g (click)="onRelationshipClick(relationship, $event)" 
             [class.selected]="relationship.isSelected"
             style="cursor: pointer;">
            
            <!-- Invisible hit area (thicker line for easier clicking) -->
            <line 
              [attr.x1]="getConnectionPoint(fromEntity, toEntity).x"
              [attr.y1]="getConnectionPoint(fromEntity, toEntity).y"
              [attr.x2]="getConnectionPoint(toEntity, fromEntity).x"
              [attr.y2]="getConnectionPoint(toEntity, fromEntity).y"
              stroke="transparent"
              stroke-width="15"
              style="pointer-events: all;">
            </line>

            <!-- Main relationship line -->
            <line 
              [attr.x1]="getConnectionPoint(fromEntity, toEntity).x"
              [attr.y1]="getConnectionPoint(fromEntity, toEntity).y"
              [attr.x2]="getConnectionPoint(toEntity, fromEntity).x"
              [attr.y2]="getConnectionPoint(toEntity, fromEntity).y"
              stroke="#3b82f6"
              [attr.stroke-width]="relationship.isSelected ? '3' : '2'"
              [attr.stroke]="relationship.isSelected ? '#10b981' : '#3b82f6'"
              style="pointer-events: none;">
            </line>
              
            <!-- From entity crow's foot notation -->
            <g [attr.transform]="getCrowsFootTransform(fromEntity, toEntity, 'from', relationship.fromCardinality)">
              <!-- One line -->
              @if (relationship.fromCardinality === 'one') {
                <line x1="-5" y1="-5" x2="-5" y2="5" 
                      stroke="#3b82f6" stroke-width="2"></line>
              }

              <!-- Zero circle + One line -->
              @if (relationship.fromCardinality === 'zero-or-one') {
                <g>
                  <circle cx="3" cy="0" r="3" fill="none" stroke="#3b82f6" stroke-width="2"></circle>
                  <line x1="-5" y1="-5" x2="-5" y2="5" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
              
              <!-- Crow's foot (many) -->
              @if (relationship.fromCardinality === 'one-or-many') {
                <g>
                  <line x1="0" y1="-5" x2="0" y2="5" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-5" y1="-5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-5" y1="5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
              
              <!-- Zero circle + Crow's foot -->
              @if (relationship.fromCardinality === 'zero-or-many') {
                <g>
                  <circle cx="8" cy="0" r="3" fill="none" stroke="#3b82f6" stroke-width="2"></circle>
                  <line x1="0" y1="-5" x2="0" y2="5" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-5" y1="-5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-5" y1="5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
            </g>

            <!-- To entity crow's foot notation -->
            <g [attr.transform]="getCrowsFootTransform(toEntity, fromEntity, 'to', relationship.toCardinality)">
              <!-- One line -->
              @if (relationship.toCardinality === 'one') {
                <line x1="-5" y1="-5" x2="-5" y2="5" 
                      stroke="#3b82f6" stroke-width="2"></line>
              }
              
              <!-- Zero circle + One line -->
              @if (relationship.toCardinality === 'zero-or-one') {
                <g>
                  <circle cx="3" cy="0" r="3" fill="none" stroke="#3b82f6" stroke-width="2"></circle>
                  <line x1="-5" y1="-5" x2="-5" y2="5" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
              
              <!-- Crow's foot (many) -->
              @if (relationship.toCardinality === 'one-or-many') {
                <g>
                  <line x1="-5" y1="-5" x2="-5" y2="5" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-10" y1="-5" x2="-5" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-10" y1="5" x2="-5" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
              
              <!-- Zero circle + Crow's foot -->
              @if (relationship.toCardinality === 'zero-or-many') {
                <g>
                  <circle cx="5" cy="0" r="3" fill="none" stroke="#3b82f6" stroke-width="2"></circle>
                  <line x1="-5" y1="-5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                  <line x1="-5" y1="5" x2="0" y2="0" stroke="#3b82f6" stroke-width="2"></line>
                </g>
              }
            </g>
            
            <!-- Relationship name label -->
            <text 
              [attr.x]="(getConnectionPoint(fromEntity, toEntity).x + getConnectionPoint(toEntity, fromEntity).x) / 2"
              [attr.y]="(getConnectionPoint(fromEntity, toEntity).y + getConnectionPoint(toEntity, fromEntity).y) / 2 - 8"
              fill="#374151"
              font-size="12"
              font-weight="500"
              text-anchor="middle"
              style="pointer-events: none;">
              {{ relationship.name }}
            </text>
            
          </g>
        </ng-container>
      </ng-container>
    </g>
    }
  </svg>
  
  <!-- Rest of your entities code remains the same -->
  <div class="entity" 
       *ngFor="let entity of entities"
       [style.left.px]="entity.position.x"
       [style.top.px]="entity.position.y"
       [style.width.px]="entity.size.width"
       [class.selected]="entity.isSelected"
       [class.weak-entity]="entity.color === '#f59e0b'"
       [class.relationship-source]="relationshipMode.isActive && relationshipMode.fromEntityId === entity.id"
       [class.relationship-target]="relationshipMode.isActive && relationshipMode.fromEntityId && relationshipMode.fromEntityId !== entity.id"
       (click)="onEntityClick(entity, $event)"
       (mousedown)="onEntityMouseDown(entity, $event)">
    
    <div class="entity-header">
      <h4>{{ entity.name }}</h4>
    </div>
    
    <div class="entity-attributes">
      <div class="attribute" *ngFor="let attr of entity.attributes">
        <i class="fas fa-key" *ngIf="attr.isPrimaryKey"></i>
        <i class="fas fa-link" *ngIf="attr.isForeignKey && !attr.isPrimaryKey"></i>
        <span class="attr-name">{{ attr.name }}</span>
        <span class="attr-type">{{ attr.type }}</span>
      </div>
    </div>
  </div>
</div>